(function () {
    'use strict';

    angular
        .module('newscombinatorKeywords')
        .directive('sourceChart', sourceChart);

    /** @ngInject */
    function sourceChart(SolrRequest) {
        var directive = {
            restrict: 'E',
            template: '<nvd3 options="vm.options" data="vm.chartdata"></nvd3>',
            scope: {
                data: '='
            },
            controller: ChartController,
            controllerAs: 'vm',
            bindToController: true
        };

        return directive;

        /** @ngInject */
        function ChartController($scope, $filter) {
            var jsonSources = JSON.parse('{                "table": "source",                "rows":                [                    {                        "source_id": 1,                        "source_link": "https://news.ycombinator.com/newest",                        "created": "2014-10-04 10:54:53",                        "source_description": "Y Combinator - Hacker News",                        "source_active": 1,                        "source_rss": 0                    },                    {                        "source_id": 3,                        "source_link": "https://lobste.rs/recent",                        "created": "2014-11-05 12:58:45",                        "source_description": "Lobsters",                        "source_active": 1,                        "source_rss": 0                    },                    {                        "source_id": 4,                        "source_link": "http://news.makerland.org/new/",                        "created": "2014-11-05 12:59:40",                        "source_description": "Makernews",                        "source_active": 1,                        "source_rss": 0                    },                    {                        "source_id": 5,                        "source_link": "http://www.reddit.com/r/BSD",                        "created": "2014-11-05 14:39:24",                        "source_description": "reddit - BSD",                        "source_active": 0,                        "source_rss": 0                    },                    {                        "source_id": 6,                        "source_link": "http://www.reddit.com/r/cableporn",                        "created": "2014-11-05 14:41:16",                        "source_description": "reddit - Cableporn",                        "source_active": 0,                        "source_rss": 0                    },                    {                        "source_id": 7,                        "source_link": "http://www.reddit.com/r/DataHoarder",                        "created": "2014-11-05 14:41:59",                        "source_description": "reddit - DataHoarder",                        "source_active": 1,                        "source_rss": 0                    },                    {                        "source_id": 8,                        "source_link": "http://www.reddit.com/r/devkit",                        "created": "2014-11-05 14:42:26",                        "source_description": "reddit - Devkit",                        "source_active": 0,                        "source_rss": 0                    },                    {                        "source_id": 9,                        "source_link": "http://www.reddit.com/r/ECE",                        "created": "2014-11-05 14:42:49",                        "source_description": "reddit - embeddedlinux",                        "source_active": 0,                        "source_rss": 0                    },                    {                        "source_id": 10,                        "source_link": "http://www.reddit.com/r/freebsd",                        "created": "2014-11-05 14:44:33",                        "source_description": "reddit - FreeBSD",                        "source_active": 0,                        "source_rss": 0                    },                    {                        "source_id": 11,                        "source_link": "http://www.reddit.com/r/haikuOS",                        "created": "2014-11-05 14:45:29",                        "source_description": "reddit - HaikuOS",                        "source_active": 0,                        "source_rss": 0                    },                    {                        "source_id": 12,                        "source_link": "http://www.reddit.com/r/homelab",                        "created": "2014-11-05 14:45:43",                        "source_description": "reddit - Homelab",                        "source_active": 0,                        "source_rss": 0                    },                    {                        "source_id": 13,                        "source_link": "http://www.reddit.com/r/kernel",                        "created": "2014-11-05 14:47:10",                        "source_description": "reddit - Kernel",                        "source_active": 1,                        "source_rss": 0                    },                    {                        "source_id": 14,                        "source_link": "http://www.reddit.com/r/linux",                        "created": "2014-11-05 14:47:26",                        "source_description": "reddit - Linux",                        "source_active": 1,                        "source_rss": 0                    },                    {                        "source_id": 15,                        "source_link": "http://www.reddit.com/r/linuxadmin",                        "created": "2014-11-05 14:47:43",                        "source_description": "reddit - Linuxadmin",                        "source_active": 0,                        "source_rss": 0                    },                    {                        "source_id": 16,                        "source_link": "http://www.reddit.com/r/linuxdev",                        "created": "2014-11-05 14:48:06",                        "source_description": "reddit - LinuxDev",                        "source_active": 0,                        "source_rss": 0                    },                    {                        "source_id": 17,                        "source_link": "http://www.reddit.com/r/linux_devices",                        "created": "2014-11-05 14:48:25",                        "source_description": "reddit - Linux Devices",                        "source_active": 0,                        "source_rss": 0                    },                    {                        "source_id": 18,                        "source_link": "http://www.reddit.com/r/NetBSD",                        "created": "2014-11-05 14:48:50",                        "source_description": "reddit - NetBSD",                        "source_active": 0,                        "source_rss": 0                    },                    {                        "source_id": 19,                        "source_link": "http://www.reddit.com/r/netsec",                        "created": "2014-11-05 14:49:10",                        "source_description": "reddit - NetSec",                        "source_active": 1,                        "source_rss": 0                    },                    {                        "source_id": 20,                        "source_link": "http://www.reddit.com/r/openbsd",                        "created": "2014-11-05 14:51:00",                        "source_description": "reddit - OpenBSD",                        "source_active": 0,                        "source_rss": 0                    },                    {                        "source_id": 21,                        "source_link": "http://www.reddit.com/r/opensourcehardware",                        "created": "2014-11-05 14:51:23",                        "source_description": "reddit - Opensource Hardware",                        "source_active": 0,                        "source_rss": 0                    },                    {                        "source_id": 22,                        "source_link": "http://www.reddit.com/r/openSUSE",                        "created": "2014-11-05 14:51:51",                        "source_description": "reddit - OpenSUSE",                        "source_active": 0,                        "source_rss": 0                    },                    {                        "source_id": 23,                        "source_link": "http://www.reddit.com/r/openwrt",                        "created": "2014-11-05 14:52:16",                        "source_description": "reddit - OpenWRT",                        "source_active": 0,                        "source_rss": 0                    },                    {                        "source_id": 24,                        "source_link": "http://www.reddit.com/r/osdev",                        "created": "2014-11-05 14:52:27",                        "source_description": "reddit - OS Dev",                        "source_active": 0,                        "source_rss": 0                    },                    {                        "source_id": 25,                        "source_link": "http://www.reddit.com/r/RTLSDR",                        "created": "2014-11-05 14:52:58",                        "source_description": "reddit - RTLSDR",                        "source_active": 0,                        "source_rss": 0                    },                    {                        "source_id": 26,                        "source_link": "http://www.reddit.com/r/sysadmin",                        "created": "2014-11-05 14:53:20",                        "source_description": "reddit - Sysadmin",                        "source_active": 1,                        "source_rss": 0                    },                    {                        "source_id": 27,                        "source_link": "http://www.reddit.com/r/systems",                        "created": "2014-11-05 14:53:37",                        "source_description": "reddit - Systems",                        "source_active": 0,                        "source_rss": 0                    },                    {                        "source_id": 28,                        "source_link": "http://www.reddit.com/r/unix",                        "created": "2014-11-05 14:53:53",                        "source_description": "reddit - Unix",                        "source_active": 0,                        "source_rss": 0                    },                    {                        "source_id": 29,                        "source_link": "http://www.reddit.com/r/usefulscripts",                        "created": "2014-11-05 14:54:07",                        "source_description": "reddit - Usefulscripts",                        "source_active": 1,                        "source_rss": 0                    },                    {                        "source_id": 30,                        "source_link": "http://www.reddit.com/r/REMath",                        "created": "2014-11-05 14:54:35",                        "source_description": "reddit - REMath",                        "source_active": 0,                        "source_rss": 0                    },                    {                        "source_id": 31,                        "source_link": "http://www.reddit.com/r/ReverseEngineering",                        "created": "2014-11-05 14:56:16",                        "source_description": "reddit - Reverse Engineering",                        "source_active": 1,                        "source_rss": 0                    },                    {                        "source_id": 32,                        "source_link": "http://www.reddit.com/r/lowlevel",                        "created": "2014-11-05 14:56:38",                        "source_description": "reddit - Lowlevel",                        "source_active": 0,                        "source_rss": 0                    },                    {                        "source_id": 33,                        "source_link": "http://www.reddit.com/r/vrd",                        "created": "2014-11-05 14:57:32",                        "source_description": "reddit - VRD",                        "source_active": 0,                        "source_rss": 0                    },                    {                        "source_id": 34,                        "source_link": "http://www.reddit.com/r/math",                        "created": "2014-11-05 14:57:54",                        "source_description": "reddit - Math",                        "source_active": 0,                        "source_rss": 0                    },                    {                        "source_id": 35,                        "source_link": "http://www.reddit.com/r/types",                        "created": "2014-11-05 14:58:23",                        "source_description": "reddit - Types",                        "source_active": 0,                        "source_rss": 0                    },                    {                        "source_id": 36,                        "source_link": "http://www.reddit.com/r/dependent_types",                        "created": "2014-11-05 14:58:39",                        "source_description": "reddit - Dependent Types",                        "source_active": 0,                        "source_rss": 0                    },                    {                        "source_id": 37,                        "source_link": "http://www.reddit.com/r/Coq",                        "created": "2014-11-05 14:59:08",                        "source_description": "reddit - Coq",                        "source_active": 0,                        "source_rss": 0                    },                    {                        "source_id": 38,                        "source_link": "http://www.reddit.com/r/haskell",                        "created": "2014-11-05 14:59:23",                        "source_description": "reddit - Haskell",                        "source_active": 0,                        "source_rss": 0                    },                    {                        "source_id": 39,                        "source_link": "http://www.reddit.com/r/ocaml",                        "created": "2014-11-05 14:59:46",                        "source_description": "reddit - Ocaml",                        "source_active": 0,                        "source_rss": 0                    },                    {                        "source_id": 40,                        "source_link": "http://www.reddit.com/r/crypto",                        "created": "2014-11-05 15:00:08",                        "source_description": "reddit - Crypto",                        "source_active": 1,                        "source_rss": 0                    },                    {                        "source_id": 41,                        "source_link": "http://www.reddit.com/r/fsharp",                        "created": "2014-11-05 15:00:24",                        "source_description": "reddit - FSharp",                        "source_active": 0,                        "source_rss": 0                    },                    {                        "source_id": 42,                        "source_link": "http://www.reddit.com/r/scala",                        "created": "2014-11-05 15:00:40",                        "source_description": "reddit - Scala",                        "source_active": 0,                        "source_rss": 0                    },                    {                        "source_id": 43,                        "source_link": "http://www.reddit.com/r/lisp",                        "created": "2014-11-05 15:00:51",                        "source_description": "reddit - Lisp",                        "source_active": 0,                        "source_rss": 0                    },                    {                        "source_id": 44,                        "source_link": "http://www.reddit.com/r/ProgrammingLanguages",                        "created": "2014-11-05 15:02:52",                        "source_description": "reddit - Programming Languages",                        "source_active": 1,                        "source_rss": 0                    },                    {                        "source_id": 45,                        "source_link": "http://www.reddit.com/r/dataisbeautiful",                        "created": "2014-11-05 15:03:30",                        "source_description": "reddit - Data is Beautiful",                        "source_active": 1,                        "source_rss": 0                    },                    {                        "source_id": 46,                        "source_link": "http://www.reddit.com/r/PhilosophyofMath",                        "created": "2014-11-05 15:03:52",                        "source_description": "reddit - Philospohy of Math",                        "source_active": 0,                        "source_rss": 0                    },                    {                        "source_id": 47,                        "source_link": "http://www.reddit.com/r/PhilosophyofScience",                        "created": "2014-11-05 15:04:23",                        "source_description": "reddit - Philosophy of Science",                        "source_active": 0,                        "source_rss": 0                    },                    {                        "source_id": 48,                        "source_link": "http://www.reddit.com/r/MachineLearning",                        "created": "2014-11-05 15:04:53",                        "source_description": "reddit - Machine Learning",                        "source_active": 1,                        "source_rss": 0                    },                    {                        "source_id": 49,                        "source_link": "http://www.reddit.com/r/IPython",                        "created": "2014-11-05 15:05:10",                        "source_description": "reddit - IPython",                        "source_active": 0,                        "source_rss": 0                    },                    {                        "source_id": 50,                        "source_link": "http://www.reddit.com/r/statistics",                        "created": "2014-11-05 15:05:24",                        "source_description": "reddit - Statistics",                        "source_active": 0,                        "source_rss": 0                    },                    {                        "source_id": 51,                        "source_link": "http://www.reddit.com/r/Design",                        "created": "2014-11-05 15:05:50",                        "source_description": "reddit - Design",                        "source_active": 1,                        "source_rss": 0                    },                    {                        "source_id": 52,                        "source_link": "http://www.reddit.com/r/webdev",                        "created": "2014-11-05 15:06:36",                        "source_description": "reddit - Webdev",                        "source_active": 1,                        "source_rss": 0                    },                    {                        "source_id": 53,                        "source_link": "http://www.reddit.com/r/web_design",                        "created": "2014-11-05 15:06:48",                        "source_description": "reddit - Webdesign",                        "source_active": 1,                        "source_rss": 0                    },                    {                        "source_id": 54,                        "source_link": "http://www.reddit.com/r/Frontend",                        "created": "2014-11-05 15:07:02",                        "source_description": "reddit - Frontend",                        "source_active": 0,                        "source_rss": 0                    },                    {                        "source_id": 55,                        "source_link": "http://www.reddit.com/r/duckduckgo",                        "created": "2014-11-05 15:07:34",                        "source_description": "reddit - DuckDuckGo",                        "source_active": 0,                        "source_rss": 0                    },                    {                        "source_id": 56,                        "source_link": "http://www.reddit.com/r/node",                        "created": "2014-11-05 15:07:53",                        "source_description": "reddit - NodeJS",                        "source_active": 0,                        "source_rss": 0                    },                    {                        "source_id": 57,                        "source_link": "http://www.reddit.com/r/angularjs",                        "created": "2014-11-05 15:09:01",                        "source_description": "reddit - Angular JS",                        "source_active": 0,                        "source_rss": 0                    },                    {                        "source_id": 58,                        "source_link": "http://www.reddit.com/r/sysor",                        "created": "2014-11-05 15:09:42",                        "source_description": "reddit - Sysor",                        "source_active": 0,                        "source_rss": 0                    },                    {                        "source_id": 59,                        "source_link": "http://www.reddit.com/r/optimization",                        "created": "2014-11-05 15:09:56",                        "source_description": "reddit - Optimization",                        "source_active": 0,                        "source_rss": 0                    },                    {                        "source_id": 60,                        "source_link": "http://www.reddit.com/r/algorithms",                        "created": "2014-11-05 15:10:14",                        "source_description": "reddit - Algorithms",                        "source_active": 0,                        "source_rss": 0                    },                    {                        "source_id": 61,                        "source_link": "http://www.reddit.com/r/BusinessIntelligence",                        "created": "2014-11-05 15:10:58",                        "source_description": "reddit - Business Intelligence",                        "source_active": 1,                        "source_rss": 0                    },                    {                        "source_id": 62,                        "source_link": "http://www.reddit.com/r/Database",                        "created": "2014-11-05 15:11:13",                        "source_description": "reddit - Database",                        "source_active": 0,                        "source_rss": 0                    },                    {                        "source_id": 63,                        "source_link": "http://www.reddit.com/r/datasets",                        "created": "2014-11-05 15:11:26",                        "source_description": "reddit - Datasets",                        "source_active": 1,                        "source_rss": 0                    },                    {                        "source_id": 64,                        "source_link": "http://www.reddit.com/r/datascience",                        "created": "2014-11-05 15:11:47",                        "source_description": "reddit - Data Science",                        "source_active": 0,                        "source_rss": 0                    },                    {                        "source_id": 65,                        "source_link": "http://www.reddit.com/r/opendata",                        "created": "2014-11-05 15:12:08",                        "source_description": "reddit - OpenData",                        "source_active": 0,                        "source_rss": 0                    },                    {                        "source_id": 66,                        "source_link": "http://www.reddit.com/r/analyzit",                        "created": "2014-11-05 15:12:27",                        "source_description": "reddit - Analyzit",                        "source_active": 0,                        "source_rss": 0                    },                    {                        "source_id": 67,                        "source_link": "http://www.reddit.com/r/semanticweb",                        "created": "2014-11-05 15:12:43",                        "source_description": "reddit - Semantic Web",                        "source_active": 0,                        "source_rss": 0                    },                    {                        "source_id": 68,                        "source_link": "http://www.reddit.com/r/visualization",                        "created": "2014-11-05 15:13:02",                        "source_description": "reddit - Visualization",                        "source_active": 1,                        "source_rss": 0                    },                    {                        "source_id": 69,                        "source_link": "http://www.reddit.com/r/analytics",                        "created": "2014-11-05 15:13:16",                        "source_description": "reddit - Analytics",                        "source_active": 0,                        "source_rss": 0                    },                    {                        "source_id": 70,                        "source_link": "http://www.reddit.com/r/programming",                        "created": "2014-11-05 15:18:03",                        "source_description": "reddit - Programming",                        "source_active": 1,                        "source_rss": 0                    },                    {                        "source_id": 71,                        "source_link": "http://www.reddit.com/r/Python",                        "created": "2014-11-05 15:18:32",                        "source_description": "reddit - Python",                        "source_active": 0,                        "source_rss": 0                    },                    {                        "source_id": 72,                        "source_link": "http://www.reddit.com/r/django",                        "created": "2014-11-05 15:18:45",                        "source_description": "reddit - Django",                        "source_active": 0,                        "source_rss": 0                    },                    {                        "source_id": 73,                        "source_link": "http://lesswrong.com/r/discussion",                        "created": "2014-11-05 15:20:16",                        "source_description": "Lesswrong Discussion",                        "source_active": 0,                        "source_rss": 0                    },                    {                        "source_id": 74,                        "source_link": "http://soylentnews.org/",                        "created": "2014-11-05 15:21:46",                        "source_description": "Soylent News",                        "source_active": 1,                        "source_rss": 0                    },                    {                        "source_id": 75,                        "source_link": "http://slashdot.org/",                        "created": "2014-11-05 15:23:57",                        "source_description": "Slashdot.org",                        "source_active": 1,                        "source_rss": 0                    },                    {                        "source_id": 76,                        "source_link": "http://www.reddit.com/r/coding",                        "created": "2014-11-05 15:25:25",                        "source_description": "reddit - Coding",                        "source_active": 0,                        "source_rss": 0                    },                    {                        "source_id": 77,                        "source_link": "http://digg.com/tag/technology",                        "created": "2014-11-05 15:28:30",                        "source_description": "digg - technology",                        "source_active": 1,                        "source_rss": 0                    },                    {                        "source_id": 78,                        "source_link": "http://coinspotting.com/newest",                        "created": "2014-11-05 15:30:05",                        "source_description": "Coinspotting - for Cryptocurrencies",                        "source_active": 1,                        "source_rss": 0                    },                    {                        "source_id": 79,                        "source_link": "http://www.datatau.com/newest",                        "created": "2014-11-05 15:30:28",                        "source_description": "DataTau - for Data Scientists",                        "source_active": 1,                        "source_rss": 0                    },                    {                        "source_id": 80,                        "source_link": "http://firespotting.com/newest",                        "created": "2014-11-05 15:30:49",                        "source_description": "Firespotting - for Ideas",                        "source_active": 1,                        "source_rss": 0                    },                    {                        "source_id": 81,                        "source_link": "http://www.medtechnologynews.com/newest",                        "created": "2014-11-05 15:32:08",                        "source_description": "Med Technology News - Hacker News for medical technology",                        "source_active": 0,                        "source_rss": 0                    },                    {                        "source_id": 82,                        "source_link": "http://inbound.org/",                        "created": "2014-11-05 15:34:29",                        "source_description": "Inbound - For Marketing",                        "source_active": 1,                        "source_rss": 0                    },                    {                        "source_id": 83,                        "source_link": "http://pullup.io/news",                        "created": "2014-11-05 15:35:34",                        "source_description": "Pullup.io - NodeJS related",                        "source_active": 1,                        "source_rss": 0                    },                    {                        "source_id": 84,                        "source_link": "http://lamernews.com/latest/0",                        "created": "2014-11-05 15:36:22",                        "source_description": "Lamernews",                        "source_active": 1,                        "source_rss": 0                    },                    {                        "source_id": 85,                        "source_link": "http://www.woodspotting.com/latest/0",                        "created": "2014-11-05 15:39:11",                        "source_description": "WoodSpotting ",                        "source_active": 1,                        "source_rss": 0                    },                    {                        "source_id": 86,                        "source_link": "http://www.reddit.com/r/Entrepreneur",                        "created": "2014-11-05 15:55:48",                        "source_description": "reddit - Entrepeneur",                        "source_active": 1,                        "source_rss": 0                    },                    {                        "source_id": 87,                        "source_link": "http://www.reddit.com/r/smallbusiness",                        "created": "2014-11-05 15:56:10",                        "source_description": "reddit - Smallbusiness",                        "source_active": 1,                        "source_rss": 0                    },                    {                        "source_id": 88,                        "source_link": "http://www.reddit.com/r/startups",                        "created": "2014-11-05 15:56:24",                        "source_description": "reddit - Startups",                        "source_active": 1,                        "source_rss": 0                    },                    {                        "source_id": 89,                        "source_link": "http://www.echojs.com/latest/0",                        "created": "2014-11-05 15:57:00",                        "source_description": "Echo JS - News for Javascript",                        "source_active": 1,                        "source_rss": 0                    },                    {                        "source_id": 91,                        "source_link": "https://usv.com/",                        "created": "2014-11-05 16:01:21",                        "source_description": "USV - Union Square Ventures",                        "source_active": 1,                        "source_rss": 0                    },                    {                        "source_id": 92,                        "source_link": "http://devmaster.net/",                        "created": "2014-11-05 16:05:55",                        "source_description": "Devmaster - Game Development News &amp; Links",                        "source_active": 1,                        "source_rss": 0                    },                    {                        "source_id": 93,                        "source_link": "http://www.dzone.com/links/queue.html",                        "created": "2014-11-05 16:09:03",                        "source_description": "Dzone - Smart Content For Tech Professionals",                        "source_active": 1,                        "source_rss": 0                    },                    {                        "source_id": 94,                        "source_link": "http://www.reddit.com/r/Bitcoin",                        "created": "2014-11-05 16:10:12",                        "source_description": "reddit - Bitcoin",                        "source_active": 1,                        "source_rss": 0                    },                    {                        "source_id": 95,                        "source_link": "http://www.reddit.com/r/Ingress",                        "created": "2014-11-21 19:58:47",                        "source_description": "reddit - Ingress",                        "source_active": 0,                        "source_rss": 0                    },                    {                        "source_id": 96,                        "source_link": "http://www.reddit.com/r/gamification",                        "created": "2014-11-21 20:03:54",                        "source_description": "reddit - Gamification",                        "source_active": 0,                        "source_rss": 0                    },                    {                        "source_id": 97,                        "source_link": "http://www.reddit.com/r/fintech",                        "created": "2015-05-30 07:22:23",                        "source_description": "reddit - Financial Technology",                        "source_active": 1,                        "source_rss": 0                    },                    {                        "source_id": 98,                        "source_link": "http://www.reddit.com/r/accounting",                        "created": "2015-05-30 07:40:49",                        "source_description": "reddit - Accounting",                        "source_active": 1,                        "source_rss": 0                    },                    {                        "source_id": 99,                        "source_link": "http://www.reddit.com/r/business",                        "created": "2015-05-30 07:43:31",                        "source_description": "reddit - Business",                        "source_active": 1,                        "source_rss": 0                    },                    {                        "source_id": 101,                        "source_link": "http://www.reddit.com/r/InternationalBusiness",                        "created": "2015-05-30 07:43:31",                        "source_description": "reddit - International Business",                        "source_active": 1,                        "source_rss": 0                    },                    {                        "source_id": 102,                        "source_link": "http://www.reddit.com/r/Insidernews",                        "created": "2015-05-30 07:43:31",                        "source_description": "reddit - Insidernews",                        "source_active": 1,                        "source_rss": 0                    },                    {                        "source_id": 103,                        "source_link": "http://www.reddit.com/r/IOT",                        "created": "2015-05-30 07:43:31",                        "source_description": "reddit - Internet of Things (IoT)",                        "source_active": 1,                        "source_rss": 0                    },                    {                        "source_id": 104,                        "source_link": "https://javascriptkicks.com",                        "created": "2015-08-01 08:12:58",                        "source_description": "JavaScript Kicks",                        "source_active": 1,                        "source_rss": 0                    },                    {                        "source_id": 105,                        "source_link": null,                        "created": "2016-02-13 02:12:54",                        "source_description": "Twitter Stream",                        "source_active": 1,                        "source_rss": 0                    },                    {                        "source_id": 106,                        "source_link": "http://www.reddit.com/r/worldnews",                        "created": "2016-02-13 05:03:42",                        "source_description": "reddit - World News",                        "source_active": 1,                        "source_rss": 0                    },                    {                        "source_id": 107,                        "source_link": null,                        "created": "2016-02-13 02:13:14",                        "source_description": "Securities and Exchange Commission (SEC) - Edgar filings",                        "source_active": 1,                        "source_rss": 0                    },                    {                        "source_id": 108,                        "source_link": "http://www.epcengineer.com/rss/news/category/1/projects",                        "created": "2016-03-28 15:39:03",                        "source_description": "RSS - EPCEngineer - Projects",                        "source_active": 1,                        "source_rss": 1                    },                    {                        "source_id": 109,                        "source_link": "http://www.epcengineer.com/rss/news/category/2/finance-investment",                        "created": "2016-03-28 15:39:03",                        "source_description": "RSS - EPCEngineer - Finance",                        "source_active": 1,                        "source_rss": 1                    },                    {                        "source_id": 110,                        "source_link": "http://www.epcengineer.com/rss/news/category/3/contract-awards",                        "created": "2016-03-28 15:39:03",                        "source_description": "RSS - EPCEngineer - Contract Awards",                        "source_active": 1,                        "source_rss": 1                    },                    {                        "source_id": 111,                        "source_link": "http://www.epcengineer.com/rss/news/category/4/engineering-construction",                        "created": "2016-03-28 15:39:03",                        "source_description": "RSS - EPCEngineer - Engineering Construction",                        "source_active": 1,                        "source_rss": 1                    },                    {                        "source_id": 112,                        "source_link": "http://www.epcengineer.com/rss/news/category/5/operations-maintenance",                        "created": "2016-03-28 15:39:03",                        "source_description": "RSS - EPCEngineer - Operation Construction",                        "source_active": 1,                        "source_rss": 1                    },                    {                        "source_id": 113,                        "source_link": "http://www.epcengineer.com/rss/news/category/6/exploration-survey",                        "created": "2016-03-28 15:39:03",                        "source_description": "RSS - EPCEngineer - Exploration Survey",                        "source_active": 1,                        "source_rss": 1                    },                    {                        "source_id": 114,                        "source_link": "http://www.epcengineer.com/rss/news/category/7/production",                        "created": "2016-03-28 15:39:03",                        "source_description": "RSS - EPCEngineer - Production",                        "source_active": 1,                        "source_rss": 1                    },                    {                        "source_id": 115,                        "source_link": "http://feeds.feedburner.com/TechCrunch/",                        "created": "2016-03-28 15:39:03",                        "source_description": "RSS - Techcrunch",                        "source_active": 1,                        "source_rss": 1                    },                    {                        "source_id": 116,                        "source_link": "http://feeds.feedburner.com/Makeuseof?format=xml",                        "created": "2016-03-28 15:39:03",                        "source_description": "RSS - MakeUseOf",                        "source_active": 1,                        "source_rss": 1                    },                    {                        "source_id": 117,                        "source_link": "http://feeds.feedburner.com/giveawayoftheday/feed?format=xml",                        "created": "2016-03-28 15:39:03",                        "source_description": "RSS - GiveAway of the Day",                        "source_active": 1,                        "source_rss": 1                    },                    {                        "source_id": 118,                        "source_link": "http://feeds.gawker.com/lifehacker/full",                        "created": "2016-03-28 15:39:03",                        "source_description": "RSS - Lifehacker",                        "source_active": 1,                        "source_rss": 1                    },                    {                        "source_id": 119,                        "source_link": "http://feeds.feedburner.com/Mashable?format=xml",                        "created": "2016-03-28 15:39:03",                        "source_description": "RSS - Mashable",                        "source_active": 1,                        "source_rss": 1                    },                    {                        "source_id": 120,                        "source_link": "http://feeds.feedburner.com/QuickOnlineTips?format=xml",                        "created": "2016-03-28 15:39:03",                        "source_description": "RSS - Quick Online Tips",                        "source_active": 1,                        "source_rss": 1                    },                    {                        "source_id": 122,                        "source_link": "http://www.epcengineer.com/rss/news/category/8/legal-regulatory",                        "created": "2016-03-28 15:39:03",                        "source_description": "RSS - EPCEngineer - Legal and Regulatory",                        "source_active": 1,                        "source_rss": 1                    },                    {                        "source_id": 123,                        "source_link": "http://www.epcengineer.com/rss/news/category/9/research-development",                        "created": "2016-03-28 15:39:03",                        "source_description": "RSS - EPCEngineer - Research and Development",                        "source_active": 1,                        "source_rss": 1                    },                    {                        "source_id": 124,                        "source_link": "http://www.epcengineer.com/rss/news/oil-and-gas",                        "created": "2016-03-28 15:39:03",                        "source_description": "RSS - EPCEngineer - Oil and Gas News",                        "source_active": 1,                        "source_rss": 1                    },                    {                        "source_id": 125,                        "source_link": "http://www.epcengineer.com/rss/news/mining-and-minerals",                        "created": "2016-03-28 15:39:03",                        "source_description": "RSS - EPCEngineer - Mining and Minerals",                        "source_active": 1,                        "source_rss": 1                    },                    {                        "source_id": 126,                        "source_link": "http://www.epcengineer.com/rss/news/power-and-energy",                        "created": "2016-03-28 15:39:03",                        "source_description": "RSS - EPCEngineer - Power and Energy",                        "source_active": 1,                        "source_rss": 1                    },                    {                        "source_id": 127,                        "source_link": "http://www.epcengineer.com/rss/news/building-and-infrastructure",                        "created": "2016-03-28 15:39:03",                        "source_description": "RSS - EPCEngineer - Building and Infrastructure",                        "source_active": 1,                        "source_rss": 1                    },                    {                        "source_id": 129,                        "source_link": "http://feeds.reuters.com/reuters/businessNews?format=xml",                        "created": "2016-03-28 15:39:03",                        "source_description": "RSS - Reuters Business News",                        "source_active": 1,                        "source_rss": 1                    },                    {                        "source_id": 130,                        "source_link": "http://feeds.reuters.com/reuters/companyNews?format=xml",                        "created": "2016-03-28 15:39:03",                        "source_description": "RSS - Reuters Company News",                        "source_active": 1,                        "source_rss": 1                    },                    {                        "source_id": 131,                        "source_link": "http://feeds.reuters.com/reuters/scienceNews?format=xml",                        "created": "2016-03-28 15:39:03",                        "source_description": "RSS - Reuters Science News",                        "source_active": 1,                        "source_rss": 1                    },                    {                        "source_id": 132,                        "source_link": "http://feeds.reuters.com/Reuters/worldNews?format=xml",                        "created": "2016-03-28 15:39:03",                        "source_description": "RSS - Reuters World News",                        "source_active": 1,                        "source_rss": 1                    },                    {                        "source_id": 133,                        "source_link": "http://www.constructionweekonline.com/rssFeed/WebRssFeeds/TENDERS/",                        "created": "2016-03-28 15:39:03",                        "source_description": "RSS - Tenders - Construction Week Online",                        "source_active": 1,                        "source_rss": 1                    }                ]            }');
            var arrSourcesLabels = [];
            var arrSourcesLinks = [];
            angular.forEach(jsonSources.rows, function (value) {
                arrSourcesLabels[value.source_id] = value.source_description;
                if(value.source_link != null) {
                    arrSourcesLinks[value.source_id] = value.source_link.replace(/\/newest$|\/recent$|\/links\/queue\.html$/, '');
                }
            });
            var vm = this;

            vm.options = {
                chart: {
                    type: 'discreteBarChart',
                    height: 450,
                    margin: {
                        top: 20,
                        right: 20,
                        bottom: 150,
                        left: 70
                    },
                    x: function (d) {
                        return d[0];
                    },
                    y: function (d) {
                        return d[1];
                    },
                    discretebar: {
                      dispatch: {
                          elementClick: function(e) {
                              var found = false;
                              angular.forEach(vm.data.keywords, function(value) {
                                  if(value.type.typeValue == 'source') {
                                      found = true;
                                      value.keyword = arrSourcesLinks[e.data[0]];
                                  }

                              });
                              if(!found) {
                                  vm.data.keywords.push({
                                      type: $filter("filter")(vm.data.keywordTypes, {typeValue: 'source'})[0],
                                      keyword: arrSourcesLinks[e.data[0]]
                                  });
                              }
                              //$scope.$apply();
                              vm.loadChart();
                          }
                      }
                    },
                    duration: 100,
                    xAxis: {

                        tickFormat: function(d) {
                          return arrSourcesLabels[d];
                        },
                        rotateLabels: -45
                    },
                    yAxis: {
                        tickFormat: function (d) {
                            return d3.format('s')(d);
                        }
                    }
                },
                title: {
                    enable: true,
                    text: 'Sources Chart'
                },
                subtitle: {
                    enable: true,
                    text: 'Where are those documents coming from?',
                    css: {
                        'text-align': 'center',
                        'margin': '10px 13px 0px 7px',
                        'font-size': '80%'
                    }
                }
            };

            vm.chartdata = [{key: "Number of Documents per Source", values: []}];

            vm.loadChart = function () {

                var query1 = new SolrQuery();
                query1.setKeywords("*:*");
                query1.getImportancy().points = 0;
                query1.getImportancy().age = 0;
                query1.addFilterQuery("content_type:document");
                query1.setFilterQueryFromArray(vm.data.keywords);
                query1.addFacetTerms("source_sites", "source_site_ids_is", 10, 1);
                var solrReq_1 = new SolrRequest.Instance();
                solrReq_1.setQuery(query1);
                console.log(query1);
                solrReq_1.loadNews().then(function () {

                    vm.chartdata[0].values = [];
                    if (solrReq_1.getFacets().count > 0) {
                        angular.forEach(solrReq_1.getFacets()["source_sites"]["buckets"], function (value) {
                            vm.chartdata[0].values.push([value.val, value.count]);

                        });
                        console.log(vm.chartdata);

                    }
                });
            };

            $scope.$watch("vm.data.keywords", vm.loadChart, true);
        }

    }

})();
